# Use "slim" (Debian) instead of "alpine" for binary compatibility
FROM python:3.13-slim

ARG DOXYGEN_VERSION=1.15.0

# Install dependencies for downloading and running Doxygen/Graphviz
RUN apt-get update && apt-get install -y --no-install-recommends \
    wget \
    xz-utils \
    graphviz \
    libstdc++6 \
    && rm -rf /var/lib/apt/lists/*

# Download and install Doxygen 1.15.0
RUN wget "https://www.doxygen.nl/files/doxygen-${DOXYGEN_VERSION}.linux.bin.tar.gz" && \
    tar -xzf doxygen-${DOXYGEN_VERSION}.linux.bin.tar.gz && \
    cp doxygen-${DOXYGEN_VERSION}/bin/doxygen /usr/local/bin/doxygen && \
    rm -rf doxygen-${DOXYGEN_VERSION}*

# Install the Python filter (patch)
RUN pip install --no-cache-dir doxypypy

WORKDIR /data

# This will now succeed because the binary is compatible with Debian
RUN doxygen --version

CMD ["doxygen", "Doxyfile"]